<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <title>Skyline Pro | High Contrast</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap');

        body {
            /* [1] НАСИТЕН СИН ГРАДИЕНТ - СЪЩИЯТ КАТО ОТ КАРТИНКАТА */
            background: radial-gradient(circle at top right, #2563eb 0%, #1e40af 40%, #0f172a 100%);
            font-family: 'Plus Jakarta Sans', sans-serif;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-x: hidden;
            color: white;
        }

        /* [2] ЦЕНТРАЛНАТА КАРТА */
        .main-card {
            background: rgba(255, 255, 255, 1);
            border-radius: 50px;
            box-shadow: 0 50px 100px -20px rgba(0,0,0,0.5);
            width: 850px;
            height: 480px;
            transform-style: preserve-3d;
            transition: transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .flipped { transform: rotateY(180deg); }
        .face { position: absolute; inset: 0; backface-visibility: hidden; border-radius: 50px; padding: 60px; }
        .back { transform: rotateY(180deg); background: #f8fafc; color: #1e293b; }

        /* [3] СЛАЙДЪР СЪС SMOOTH АНИМАЦИЯ */
        .slider-container {
            width: 100vw;
            overflow-x: auto;
            display: flex;
            gap: 25px;
            padding: 40px 10%;
            scroll-behavior: smooth;
            -ms-overflow-style: none; /* Скриваме скролбара */
            scrollbar-width: none;
            scroll-snap-type: x mandatory;
        }

        .slider-container::-webkit-scrollbar { display: none; }

        .mini-card {
            flex: 0 0 280px;
            height: 180px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 30px;
            padding: 25px;
            scroll-snap-align: center;
            transition: all 0.4s ease;
        }

        .mini-card:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.05) translateY(-10px);
        }

        /* Текстови стилове */
        textarea {
            color: #0f172a;
            font-weight: 800;
            letter-spacing: -1px;
        }
    </style>
</head>
<body>

    <header class="w-full p-10 flex justify-between items-center max-w-7xl">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-white rounded-xl flex items-center justify-center">
                <i data-lucide="layers" class="text-blue-600 w-6 h-6"></i>
            </div>
            <span class="text-xl font-black tracking-tight">SKYLINE</span>
        </div>
        <nav class="flex gap-8 text-sm font-bold text-white/60 uppercase tracking-widest">
            <a href="#" class="text-white">Studio</a>
            <a href="#" class="hover:text-white transition">Library</a>
            <a href="#" class="hover:text-white transition">Vault</a>
        </nav>
    </header>

    <main class="mt-10 mb-20">
        <div class="main-card" id="cardElement">
            <div class="face front flex flex-col">
                <div class="mb-10 flex items-center gap-2">
                    <span class="text-[10px] font-black uppercase tracking-[0.4em] text-blue-600">Flashcard Engine</span>
                </div>
                <textarea id="q-in" class="text-5xl bg-transparent border-none outline-none resize-none flex-1 placeholder-gray-200" placeholder="Start typing..."></textarea>
                <button onclick="runAI()" id="run-btn" class="w-full py-6 bg-blue-600 text-white rounded-[28px] font-black text-xl hover:bg-blue-700 transition-all active:scale-95 shadow-lg shadow-blue-900/20">
                    Generate Analysis
                </button>
            </div>
            
            <div class="face back flex flex-col">
                <div class="flex justify-between items-center mb-10">
                    <span class="text-[10px] font-black uppercase tracking-[0.4em] text-blue-600">AI Result</span>
                    <button onclick="flipBack()" class="p-2 hover:bg-gray-100 rounded-full transition"><i data-lucide="x" class="text-gray-400"></i></button>
                </div>
                <textarea id="a-out" class="text-2xl font-bold bg-transparent border-none outline-none resize-none flex-1 text-slate-700" readonly></textarea>
                <button onclick="saveCard()" class="w-full py-6 bg-slate-900 text-white rounded-[28px] font-black text-xl">Save to Collection</button>
            </div>
        </div>
    </main>

    <div class="w-full max-w-7xl px-10 mb-5 flex justify-between items-end">
        <div>
            <h2 class="text-3xl font-black tracking-tighter">Your Library</h2>
            <p class="text-white/40 text-sm font-medium">Swipe through your latest nodes</p>
        </div>
        <div class="flex gap-2">
            <button onclick="scrollSlider(-300)" class="p-4 bg-white/5 rounded-full hover:bg-white/10 transition"><i data-lucide="chevron-left"></i></button>
            <button onclick="scrollSlider(300)" class="p-4 bg-white/5 rounded-full hover:bg-white/10 transition"><i data-lucide="chevron-right"></i></button>
        </div>
    </div>

    <div class="slider-container" id="deck-grid">
        </div>

    <script>
        const S_URL = "https://zfqpfhtbpfdudbpqzbbg.supabase.co";
        const S_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpmcXBmaHRicGZkdWRicHF6YmJnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgyOTQ5NzQsImV4cCI6MjA4Mzg3MDk3NH0.QnmNeFn9LX9ZIc-bINH_4DNKFeJj9LCYU7QF5ZwfaDE";
        const sb = window.supabase.createClient(S_URL, S_KEY);
        const WORKER = "https://curly-mountain-4c28.boy05geo.workers.dev";

        lucide.createIcons();
        loadDeck();

        function scrollSlider(amt) {
            document.getElementById('deck-grid').scrollBy({ left: amt, behavior: 'smooth' });
        }

        async function runAI() {
            const q = document.getElementById('q-in').value;
            if(!q) return;
            const btn = document.getElementById('run-btn');
            btn.innerText = "Processing...";
            
            const res = await fetch(WORKER, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ prompt: q }) });
            const data = await res.json();
            
            document.getElementById('a-out').value = data.answer;
            document.getElementById('cardElement').classList.add('flipped');
            btn.innerText = "Generate Analysis";
        }

        function flipBack() { document.getElementById('cardElement').classList.remove('flipped'); }

        async function saveCard() {
            const f = document.getElementById('q-in').value;
            const b = document.getElementById('a-out').value;
            await sb.from('cards').insert([{ front: f, back: b }]);
            loadDeck();
            flipBack();
        }

        async function loadDeck() {
            const { data } = await sb.from('cards').select('*').order('created_at', { ascending: false });
            const grid = document.getElementById('deck-grid');
            grid.innerHTML = data.map(c => `
                <div class="mini-card flex flex-col justify-between">
                    <div class="w-8 h-8 bg-blue-500/20 rounded-lg flex items-center justify-center mb-4">
                        <i data-lucide="file-text" class="text-blue-400 w-4 h-4"></i>
                    </div>
                    <div class="text-sm font-bold text-white/90 line-clamp-3">${c.front}</div>
                    <div class="mt-4 text-[10px] font-black uppercase tracking-widest text-white/20">Saved node</div>
                </div>
            `).join('');
            lucide.createIcons();
        }
    </script>
</body>
</html>
