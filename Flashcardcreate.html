<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <title>Skyline Studio</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { background: #000; color: white; display: flex; align-items: center; justify-content: center; height: 100vh; font-family: sans-serif; }
        .card { width: 400px; height: 250px; position: relative; cursor: pointer; transition: transform 0.6s; transform-style: preserve-3d; }
        .card.flipped { transform: rotateY(180deg); }
        .face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; border-radius: 20px; padding: 20px; border: 1px solid #333; background: #111; display: flex; flex-direction: column; }
        .back { transform: rotateY(180deg); background: #050505; border-color: #a855f7; }
    </style>
</head>
<body>

    <div class="card" id="fcard" onclick="this.classList.toggle('flipped')">
        <div class="face front">
            <span class="text-[10px] text-purple-500 font-bold mb-2">–í–™–ü–†–û–°</span>
            <textarea id="q" class="bg-transparent border-none text-xl outline-none flex-1 resize-none" placeholder="–ù–∞–ø–∏—à–∏ –Ω–µ—â–æ..." onclick="event.stopPropagation()"></textarea>
            <button onclick="askAI(event)" id="aiBtn" class="bg-white/10 hover:bg-white/20 p-2 rounded-lg text-sm font-bold transition-all">‚ú® –ì–µ–Ω–µ—Ä–∏—Ä–∞–π –æ—Ç–≥–æ–≤–æ—Ä</button>
        </div>
        <div class="face back">
            <span class="text-[10px] text-green-500 font-bold mb-2">–û–¢–ì–û–í–û–†</span>
            <textarea id="a" class="bg-transparent border-none text-lg outline-none flex-1 resize-none" onclick="event.stopPropagation()"></textarea>
            <button onclick="save(event)" class="bg-purple-600 p-2 rounded-lg text-sm font-bold">üíæ –ó–∞–ø–∞–∑–∏ –≤ Supabase</button>
        </div>
    </div>

    <script>
        // –ò–∑–ø–æ–ª–∑–≤–∞–º–µ 'sbClient', –∑–∞ –¥–∞ –Ω—è–º–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç —Å –∏–º–µ—Ç–æ –Ω–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞—Ç–∞
        const sbClient = window.supabase.createClient("https://zfqpfhtbpfdudbpqzbbg.supabase.co", "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpmcXBmaHRicGZkdWRicHF6YmJnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgyOTQ5NzQsImV4cCI6MjA4Mzg3MDk3NH0.QnmNeFn9LX9ZIc-bINH_4DNKFeJj9LCYU7QF5ZwfaDE");

        async function askAI(e) {
            e.stopPropagation();
            const btn = document.getElementById('aiBtn');
            const prompt = document.getElementById('q').value;
            if(!prompt) return alert("–ü—ä—Ä–≤–æ –Ω–∞–ø–∏—à–∏ –≤—ä–ø—Ä–æ—Å!");

            btn.innerText = "–ú–∏—Å–ª–∏...";
            btn.disabled = true;

            try {
                const res = await fetch("https://curly-mountain-4c28.boy05geo.workers.dev", {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ prompt: prompt })
                });
                const data = await res.json();
                document.getElementById('a').value = data.answer; //
                document.getElementById('fcard').classList.add('flipped');
            } catch (err) {
                alert("–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –≤—Ä—ä–∑–∫–∞—Ç–∞ —Å AI. –ü—Ä–æ–≤–µ—Ä–∏ –∫–æ–¥–∞ –Ω–∞ Worker-–∞!");
            } finally {
                btn.innerText = "‚ú® –ì–µ–Ω–µ—Ä–∏—Ä–∞–π –æ—Ç–≥–æ–≤–æ—Ä";
                btn.disabled = false;
            }
        }

        async function save(e) {
            e.stopPropagation();
            const q = document.getElementById('q').value;
            const a = document.getElementById('a').value;
            const { error } = await sbClient.from('cards').insert([{ front: q, back: a }]);
            if(!error) alert("–£—Å–ø–µ—à–Ω–æ –∑–∞–ø–∞–∑–µ–Ω–æ!");
            else alert("–ì—Ä–µ—à–∫–∞: –ü—Ä–æ–≤–µ—Ä–∏ –¥–∞–ª–∏ –∏–º–∞—à —Ç–∞–±–ª–∏—Ü–∞ 'cards' –≤ Supabase!");
        }
    </script>
</body>
</html>
