<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Your Account — Study Space</title>
  <style>
        :root{
      --bg-1: #e9f6ff;
      --bg-2: #f4fbff;
      --accent: #2f7cd4;
      --muted: #4d6f8f;
      --card: #ffffff;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial;color:var(--muted);background:linear-gradient(180deg,var(--bg-1),var(--bg-2));}
    .wrap{max-width:980px;margin:32px auto;padding:20px}
    .top-menu{margin-bottom:10px}
    .top-menu a{color:var(--accent);font-weight:700;text-decoration:none}
    .top-menu a:hover{text-decoration:underline}

    /* account menu uses same dropdown styles as edit-profile */
    .menu-wrap{position:relative;display:inline-block}
    .menu-btn{background:linear-gradient(180deg,var(--accent),#256fb3);color:#fff;border:none;padding:8px 10px;border-radius:10px;cursor:pointer;font-weight:700}
    .menu-dropdown{position:absolute;right:0;top:42px;background:#fff;border-radius:10px;box-shadow:0 12px 40px rgba(10,30,60,0.08);list-style:none;padding:6px 8px;display:none;min-width:180px;border:1px solid rgba(20,40,80,0.04)}
    .menu-dropdown.show{display:block}
    .menu-dropdown li{padding:6px 8px}
    .menu-dropdown a{color:var(--muted);text-decoration:none;display:block}
    .menu-dropdown a:hover{color:var(--accent)}

    .account-grid{display:grid;grid-template-columns:260px 1fr;gap:18px;align-items:start}
    .left-panel{display:flex;align-items:flex-start}
    .avatar-card{width:100%;background:linear-gradient(180deg,#fff,#fbfdff);border-radius:12px;padding:18px;border:1px solid rgba(20,40,80,0.04);box-shadow:0 8px 30px rgba(10,30,60,0.04);text-align:center}
    .acct-avatar{width:160px;height:160px;border-radius:18px;object-fit:cover;border:6px solid rgba(255,255,255,0.9);box-shadow:0 12px 30px rgba(10,30,60,0.06)}
    .acct-nick{margin-top:12px;font-weight:800;color:var(--accent)}
    .avatar-menu{margin-top:12px;display:flex;align-items:center;gap:10px;justify-content:center}
    .home-btn{padding:8px 12px;border-radius:10px;background:linear-gradient(180deg,rgba(255,255,255,0.9),rgba(245,250,255,0.95));border:1px solid rgba(0,0,0,0.04);color:var(--accent);font-weight:700;text-decoration:none;transition:transform 220ms ease, box-shadow 220ms ease}
    .home-btn:hover{transform:translateY(-4px);box-shadow:0 12px 28px rgba(47,124,212,0.10)}

    /* hamburger */
    .hamburger{width:44px;height:36px;display:inline-flex;align-items:center;justify-content:center;border-radius:8px;background:transparent;border:1px solid rgba(0,0,0,0.06);cursor:pointer;padding:6px;transition:background 200ms ease}
    .hamburger .bar{display:block;width:20px;height:2px;background:var(--accent);margin:3px 0;transition:transform 260ms cubic-bezier(.2,.9,.3,1), opacity 160ms, background 160ms}
    .hamburger.open{background:linear-gradient(180deg,var(--accent),#256fb3)}
    .hamburger.open .bar{background:#fff}
    .hamburger.open .bar:nth-child(1){transform:translateY(7px) rotate(45deg)}
    .hamburger.open .bar:nth-child(2){opacity:0}
    .hamburger.open .bar:nth-child(3){transform:translateY(-7px) rotate(-45deg)}

    .menu-dropdown{position:absolute;top:46px;left:50%;transform:translateX(-50%);min-width:200px}
    .acct-header{display:flex;flex-direction:column;align-items:center;gap:6px;margin-bottom:18px}
    .acct-header h1{margin:0;color:var(--accent);font-size:28px}
    .acct-header .sub{margin:0;color:var(--muted)}

    .account-card{background:linear-gradient(180deg, #ffffff, #fbfdff);border-radius:14px;padding:20px;border:1px solid rgba(20,40,80,0.04);box-shadow:0 12px 40px rgba(10,30,60,0.06);transition:transform 260ms,box-shadow 260ms}
    .account-card:hover{transform:translateY(-4px);box-shadow:0 26px 72px rgba(8,32,80,0.08)}

    .field{margin-bottom:14px;display:flex;flex-direction:column;gap:8px}
    .field label{font-weight:600;color:var(--accent);font-size:13px}
    .field input[type="text"], .field input[type="email"], .field input[type="date"], .field input[type="password"], .field select, .field input[type="color"]{padding:10px 12px;border-radius:10px;border:1px solid rgba(20,40,80,0.06);transition:box-shadow 180ms, border-color 160ms;outline:none;background:linear-gradient(180deg,#fff,#fbfdff)}
    .field input[readonly]{background:#e6eef8;color:#33475b;box-shadow:inset 0 2px 6px rgba(4,20,40,0.03);cursor:not-allowed}
    .field input:focus, .field select:focus{box-shadow:0 8px 30px rgba(47,124,212,0.06);border-color:var(--accent)}

    .pw-row, .loc-row{display:flex;gap:8px}
    .pw-row input{flex:1}
    .loc-row input{flex:1}
    .tiny-btn{padding:8px 10px;border-radius:10px;border:1px solid rgba(0,0,0,0.06);background:var(--card);cursor:pointer}
    .tiny-btn:hover{transform:translateY(-2px)}

    .suggestions{margin:8px 0 0 0;padding:0;list-style:none;max-height:160px;overflow:auto;border-radius:10px;border:1px solid rgba(20,40,80,0.04);background:#fff;box-shadow:0 6px 24px rgba(10,30,60,0.04);display:none}
    .suggestions.show{display:block}
    .suggestions li{padding:10px 12px;border-bottom:1px solid rgba(0,0,0,0.03);cursor:pointer}
    .suggestions li:last-child{border-bottom:none}
    .suggestions li:hover{background:linear-gradient(90deg, rgba(47,124,212,0.06), rgba(47,124,212,0.02))}

    .actions{display:flex;justify-content:flex-end;margin-top:12px}
    .save-btn{padding:10px 14px;border-radius:12px;border:none;background:linear-gradient(180deg,var(--accent),#256fb3);color:#fff;cursor:pointer;box-shadow:0 12px 34px rgba(47,124,212,0.12)}
    .save-btn:hover{transform:translateY(-4px)}

    .toast{position:fixed;right:16px;bottom:20px;padding:12px 16px;border-radius:10px;background:rgba(0,0,0,0.78);color:#fff;opacity:0;transform:translateY(12px);transition:opacity 220ms,transform 220ms}
    .toast.show{opacity:1;transform:none}

    @media(max-width:720px){.wrap{padding:14px}.account-card{padding:14px}.acct-header h1{font-size:22px}}

  </style>
</head>
<body>
  <main class="wrap">
    <nav class="top-menu">
      <a class="home-link" href="homepage (3) (1).html">← Home</a>
      <div class="menu-wrap">
        <button id="acctMenuBtn" class="menu-btn" aria-haspopup="true" aria-expanded="false">☰</button>
        <ul id="acctMenuDropdown" class="menu-dropdown" role="menu" aria-hidden="true">
          <li role="none"><a role="menuitem" href="homepage (3) (1).html">Home</a></li>
          <li role="none"><a role="menuitem" href="edit-profile.html">Edit profile</a></li>
          <li role="none"><a role="menuitem" href="connect-apps.html">Connect apps</a></li>
        </ul>
      </div>
    </nav>

    <header class="acct-header">
      <h1>Your Account</h1>
      <p class="sub">Manage your profile details — secure, private, and synced to your theme.</p>
    </header>

    <div class="account-grid">
      <aside class="left-panel">
          <div class="avatar-card">
            <img id="acctAvatar" src="images/user.png" alt="avatar" class="acct-avatar">
            <div id="acctNickDisplay" class="acct-nick">Nickname</div>
            <div class="avatar-menu">
              <button id="acctMenuBtn" class="hamburger" aria-haspopup="true" aria-expanded="false" aria-controls="acctMenuDropdown">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
              </button>
              <a href="homepage.html" class="home-btn">Home</a>
              <ul id="acctMenuDropdown" class="menu-dropdown" role="menu" aria-hidden="true">
                <li role="none"><a role="menuitem" href="homepage.html">Home</a></li>
                <li role="none"><a role="menuitem" href="edit-profile.html">Edit profile</a></li>
                <li role="none"><a role="menuitem" href="connect-apps.html">Connect apps</a></li>
              </ul>
            </div>
          </div>
      </aside>

      <section class="right-panel">
        <section class="account-card">
          <form id="accountForm" autocomplete="off">
        <div class="field">
          <label for="email">Email</label>
          <input id="email" type="email" readonly />
        </div>

        <div class="field password-field">
          <label for="password">Password</label>
          <div class="pw-row">
            <input id="password" type="password" />
            <button type="button" id="togglePassword" class="tiny-btn" aria-label="Show password">Show</button>
          </div>
        </div>

        <div class="field">
          <label for="birthday">Birthday</label>
          <input id="birthday" type="date" />
        </div>

        <div class="field location-field">
          <label for="location">Location</label>
          <div class="loc-row">
            <input id="location" type="text" placeholder="City, Country" autocomplete="off" />
            <button type="button" id="detectLoc" class="tiny-btn">Detect</button>
          </div>
          <ul id="locSuggestions" class="suggestions" aria-hidden="true"></ul>
        </div>

        <div class="field">
          <label for="language">Language preference</label>
          <select id="language">
            <option value="en">English</option>
            <option value="bg">Bulgarian</option>
            <option value="es">Spanish</option>
            <option value="fr">French</option>
            <option value="de">German</option>
          </select>
        </div>

            <div class="actions">
              <button id="saveAccount" type="button" class="save-btn">Save changes</button>
            </div>
          </form>
        </section>
      </section>
    </div>

    <div id="toast" class="toast" aria-live="polite"></div>
  </main>

  <script>
    // account.js — handles account form, theme application, location suggestions
    (function(){
    const LOCAL_ACCOUNT = 'user_account_v1';

    // elements
    const emailEl = document.getElementById('email');
    const pwEl = document.getElementById('password');
    const togglePw = document.getElementById('togglePassword');
    const birthdayEl = document.getElementById('birthday');
    const locationEl = document.getElementById('location');
    const detectBtn = document.getElementById('detectLoc');
    const suggestions = document.getElementById('locSuggestions');
    const langEl = document.getElementById('language');
    const saveBtn = document.getElementById('saveAccount');
    const toast = document.getElementById('toast');

    // small city list (sample) — name, country, lat, lon
    const CITIES = [
      {name:'Sofia', country:'BG', lat:42.6977, lon:23.3219},
      {name:'Plovdiv', country:'BG', lat:42.1354, lon:24.7453},
      {name:'Varna', country:'BG', lat:43.2141, lon:27.9147},
      {name:'Burgas', country:'BG', lat:42.5048, lon:27.4626},
      {name:'London', country:'GB', lat:51.5074, lon:-0.1278},
      {name:'New York', country:'US', lat:40.7128, lon:-74.0060},
      {name:'San Francisco', country:'US', lat:37.7749, lon:-122.4194},
      {name:'Berlin', country:'DE', lat:52.52, lon:13.4050},
      {name:'Madrid', country:'ES', lat:40.4168, lon:-3.7038},
      {name:'Rome', country:'IT', lat:41.9028, lon:12.4964},
      {name:'Paris', country:'FR', lat:48.8566, lon:2.3522},
      {name:'Istanbul', country:'TR', lat:41.0082, lon:28.9784},
      {name:'Moscow', country:'RU', lat:55.7558, lon:37.6173},
      {name:'Tokyo', country:'JP', lat:35.6762, lon:139.6503},
      {name:'Sydney', country:'AU', lat:-33.8688, lon:151.2093}
    ];

    // theme application: read from avatar_components_v1 (accent and bgColor)
    function applyProfileTheme(){
      try{
        const raw = localStorage.getItem('avatar_components_v1');
        if(!raw) return;
        const s = JSON.parse(raw);
        if(s.accent) document.documentElement.style.setProperty('--accent', s.accent);
        if(s.bgColor){
          const bg = s.bgColor;
          const light = (function(h){
            // simple lighten
            const hex = h.replace('#','');
            const n = parseInt(hex.length===3?hex.split('').map(c=>c+c).join(''):hex,16);
            const r = (n>>16)&255, g=(n>>8)&255,b=n&255;
            const R = Math.round(r + (255-r)*0.12), G = Math.round(g + (255-g)*0.12), B = Math.round(b + (255-b)*0.12);
            const toHex = n=>('0'+n.toString(16)).slice(-2);
            return '#'+toHex(R)+toHex(G)+toHex(B);
          })(bg);
          document.documentElement.style.setProperty('--bg-1', bg);
          document.documentElement.style.setProperty('--bg-2', light);
          document.body.style.background = `linear-gradient(180deg, ${bg}, ${light})`;
        }
        // set nickname if available (on acct page)
        try{
          const nickEl = document.getElementById('acctNickDisplay');
          if(nickEl) nickEl.textContent = s.nick || 'Nickname';
        }catch(e){}
      }catch(e){console.warn('applyProfileTheme failed', e)}
    }

    // small helper: haversine distance
    function haversine(lat1,lon1,lat2,lon2){
      const toRad = d => d * Math.PI/180;
      const R = 6371; // km
      const dLat = toRad(lat2-lat1);
      const dLon = toRad(lon2-lon1);
      const a = Math.sin(dLat/2)*Math.sin(dLat/2) + Math.cos(toRad(lat1))*Math.cos(toRad(lat2))*Math.sin(dLon/2)*Math.sin(dLon/2);
      const c = 2*Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
      return R*c;
    }

    function showSuggestions(list){
      suggestions.innerHTML = '';
      if(!list || !list.length) { suggestions.classList.remove('show'); suggestions.setAttribute('aria-hidden','true'); return; }
      list.forEach(item => {
        const li = document.createElement('li');
        li.textContent = `${item.name}, ${item.country}`;
        li.tabIndex = 0;
        li.addEventListener('click', ()=>{ locationEl.value = `${item.name}, ${item.country}`; suggestions.classList.remove('show'); saveAccount(); });
        li.addEventListener('keydown', (e)=>{ if(e.key==='Enter') { li.click(); } });
        suggestions.appendChild(li);
      });
      suggestions.classList.add('show');
      suggestions.setAttribute('aria-hidden','false');
    }

    function detectNearby(){
      if(!navigator.geolocation){ showToast('Geolocation not supported'); return; }
      showToast('Detecting nearby cities — please allow location access');
      navigator.geolocation.getCurrentPosition((pos)=>{
        const lat = pos.coords.latitude, lon = pos.coords.longitude;
        // compute distances
        const list = CITIES.map(c=>({ ...c, d: haversine(lat,lon,c.lat,c.lon) })).sort((a,b)=>a.d-b.d).slice(0,6);
        showSuggestions(list);
      }, (err)=>{
        showToast('Location blocked or unavailable');
        // fallback: show local cities first
        showSuggestions(CITIES.slice(0,6));
      }, {timeout:8000});
    }

    function loadAccount(){
      try{
        const raw = localStorage.getItem(LOCAL_ACCOUNT);
        if(!raw) return;
        const s = JSON.parse(raw);
        if(s.email) emailEl.value = s.email;
        if(s.birthday) birthdayEl.value = s.birthday;
        if(s.location) locationEl.value = s.location;
        if(s.language) langEl.value = s.language;
        if(s.password) pwEl.value = s.password;
      }catch(e){console.warn(e)}
    }

    function saveAccount(){
      try{
        const payload = {
          email: emailEl.value || '',
          password: pwEl.value || '',
          birthday: birthdayEl.value || '',
          location: locationEl.value || '',
          language: langEl.value || ''
        };
        localStorage.setItem(LOCAL_ACCOUNT, JSON.stringify(payload));
        showToast('Account saved');
      }catch(e){ showToast('Save failed'); }
    }

    function showToast(msg, ms=1800){
      toast.textContent = msg; toast.classList.add('show');
      clearTimeout(toast._t);
      toast._t = setTimeout(()=> toast.classList.remove('show'), ms);
    }

    // toggle password visibility
    togglePw && togglePw.addEventListener('click', ()=>{
      if(pwEl.type === 'password'){ pwEl.type = 'text'; togglePw.textContent = 'Hide'; }
      else { pwEl.type = 'password'; togglePw.textContent = 'Show'; }
    });

    detectBtn && detectBtn.addEventListener('click', detectNearby);
    saveBtn && saveBtn.addEventListener('click', saveAccount);

    // when clicking outside suggestions hide it
    document.addEventListener('click', (e)=>{ if(!e.target.closest('.location-field')){ suggestions.classList.remove('show'); suggestions.setAttribute('aria-hidden','true'); } });

    // init: apply theme, load saved account; if no email set, attempt to pull from avatar_components_v1 (none) or placeholder
    applyProfileTheme();
    loadAccount();
    // if email empty, use placeholder
    if(!emailEl.value) emailEl.value = 'user@example.com';

    // set avatar image from saved profileAvatar if present
    try{
      const saved = localStorage.getItem('profileAvatar');
      const acctImg = document.getElementById('acctAvatar');
      if(saved && acctImg) acctImg.src = saved;
    }catch(e){console.warn('load acct avatar failed', e)}

    // update account avatar if changed in another tab
    window.addEventListener('storage', (e)=>{
      if(e.key === 'profileAvatar'){
        try{ const acctImg2 = document.getElementById('acctAvatar'); if(acctImg2 && e.newValue) acctImg2.src = e.newValue; }catch(err){}
      }
    });

    // account menu dropdown
    const acctMenuBtn = document.getElementById('acctMenuBtn');
    const acctMenuDropdown = document.getElementById('acctMenuDropdown');
    if(acctMenuBtn && acctMenuDropdown){
      acctMenuBtn.addEventListener('click', ()=>{
        const open = acctMenuBtn.classList.toggle('open');
        acctMenuDropdown.classList.toggle('show', open);
        acctMenuBtn.setAttribute('aria-expanded', open ? 'true' : 'false');
        acctMenuDropdown.setAttribute('aria-hidden', open ? 'false' : 'true');
      });
      // close when clicking outside
      document.addEventListener('click', (e)=>{ if(!e.target.closest('.avatar-menu') && !e.target.closest('#acctMenuBtn')){ acctMenuDropdown.classList.remove('show'); acctMenuBtn.classList.remove('open'); acctMenuBtn.setAttribute('aria-expanded','false'); acctMenuDropdown.setAttribute('aria-hidden','true'); } });
      // keyboard: Esc to close
      document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape'){ acctMenuDropdown.classList.remove('show'); acctMenuBtn.classList.remove('open'); acctMenuBtn.setAttribute('aria-expanded','false'); acctMenuDropdown.setAttribute('aria-hidden','true'); } });
    }

  })();

  </script>
</body>
</html>
